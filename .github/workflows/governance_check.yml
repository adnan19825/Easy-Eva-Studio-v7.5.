name: Governance & Compliance Check

on:
  push:
    branches: [ "master", "main" ]
  pull_request:
    branches: [ "master", "main" ]

env:
  CARGO_TERM_COLOR: always

jobs:
  # Job 1: Die Gesetze prÃ¼fen (Dein Rust-Validator)
  policy-audit:
    name: ğŸ›ï¸ Validate Security Profile
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          profile: minimal

      - name: ğŸ›¡ï¸ Run Policy Validator
        run: cargo run --bin studio_validator

  # Job 2: Die Technik prÃ¼fen (Wasm GrÃ¶ÃŸe)
  artifact-compliance:
    name: âš–ï¸ Check Wasm Size Limit
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Wasm Target
        run: rustup target add wasm32-unknown-unknown

      - name: ğŸ—ï¸ Build Decoder
        run: cargo build --lib --target wasm32-unknown-unknown --release

      - name: ğŸ“ Weigh Artifact
        run: |
          cd target/wasm32-unknown-unknown/release
          size=$(ls -l easyfhe_core.wasm | awk '{print $5}')
          echo "Detected Size: $size bytes"
      - name: ğŸ“ Weigh Artifact
        run: |
          # ... (vorheriger Code bleibt unverÃ¤ndert) ...

      # NEU: Das Wasm-Artefakt fÃ¼r das Web-Deployment speichern
      - name: ğŸ“¦ Save Wasm Artifact for Web
        uses: actions/upload-artifact@v3
        with:
          name: wasm-decoder
          path: target/wasm32-unknown-unknown/release/easyfhe_core.wasm

          # Limit: 1.3 MB = 1363148 bytes
               if [ "$size" -gt 1363148 ];
        
            echo "âŒ VIOLATION: Artifact exceeds 1.3MB Quantinuum Limit!"
            exit 1
          else
            echo "âœ… COMPLIANCE: Artifact is within limits."
          fi

